{% extends 'base.html' %}

{% block title %}Controle de Notas{% endblock %}

{% block content %}
<div class="container py-4">

  <!-- HEADER + BOTÃO FILTRO -->
  <div class="d-flex justify-content-between align-items-center mb-4 flex-wrap gap-2">
    <div>
      <h4 class="fw-bold text-primary mb-1">
        <i class="bi bi-file-earmark-text me-1"></i> Controle de Notas
      </h4>
      <small class="text-muted">
        Visualização e edição das notas fiscais cadastradas
      </small>
    </div>

    <button class="btn btn-outline-primary btn-sm"
            data-bs-toggle="offcanvas"
            data-bs-target="#offcanvasFiltro">
      <i class="bi bi-funnel me-1"></i> Filtros
    </button>
  </div>

  <!-- ================= TABELA ================= -->
  <div class="card shadow-sm border-0 rounded-4">
    <div class="card-body p-4">

      {% if notafiscal_list %}
      <div class="table-responsive border rounded-3">
        <table class="table table-hover align-middle mb-0 small">
          <thead class="table-light text-uppercase">
            <tr>
              <th>ID</th>
              <th>Data</th>
              <th>Turno</th>
              <th>NF</th>
              <th>Origem</th>
              <th>Pallet</th>
              <th>Veículo</th>
              <th>Peso</th>
              <th class="text-center">Ações</th>
            </tr>
          </thead>
          <tbody>
            {% for nota in notafiscal_list %}
            <tr>
              <td class="fw-semibold">{{ nota.id }}</td>
              <td>{{ nota.data|date:"d/m/Y" }}</td>
              <td>{{ nota.get_turno_display }}</td>
              <td>{{ nota.nf }}</td>
              <td>{{ nota.un_origem }}</td>
              <td>{{ nota.qnt_pallet }}</td>
              <td>{{ nota.tipo_veiculo }}</td>
              <td>{{ nota.peso_nota }}</td>
              <td class="text-center">
                <a href="{% url 'notas_update' pk=nota.pk %}"
                   class="btn btn-sm btn-warning"
                   data-bs-toggle="tooltip"
                   title="Editar nota">
                  <i class="bi bi-pencil-square"></i>
                </a>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% else %}
      <div class="text-center text-muted py-4">
        <i class="bi bi-inbox me-1"></i> Nenhuma nota encontrada
      </div>
      {% endif %}

    </div>
  </div>

</div>

<!-- ================= OFFCANVAS FILTROS ================= -->
<div class="offcanvas offcanvas-end" tabindex="-1" id="offcanvasFiltro">
  <div class="offcanvas-header">
    <h5 class="fw-bold text-primary">
      <i class="bi bi-funnel me-1"></i> Filtros
    </h5>
    <button type="button" class="btn-close" data-bs-dismiss="offcanvas"></button>
  </div>

  <div class="offcanvas-body">

    <form method="get">

      <div class="mb-3">
        <label class="form-label small">Data</label>
        <input type="date"
               name="data"
               class="form-control form-control-sm"
               value="{{ request.GET.data }}">
      </div>

      <div class="mb-3">
        <label class="form-label small">NF</label>
        <input type="text"
               name="nf"
               class="form-control form-control-sm"
               value="{{ request.GET.nf }}">
      </div>

      <div class="mb-3">
        <label class="form-label small">Tipo de Veículo</label>
        <select name="tipo_veiculo" class="form-select form-select-sm">
          <option value="">Todos</option>
          <option value="3/4" {% if request.GET.tipo_veiculo == "3/4" %}selected{% endif %}>3/4</option>
          <option value="Toco" {% if request.GET.tipo_veiculo == "Toco" %}selected{% endif %}>Toco</option>
          <option value="Truck" {% if request.GET.tipo_veiculo == "Truck" %}selected{% endif %}>Truck</option>
          <option value="Carreta" {% if request.GET.tipo_veiculo == "Carreta" %}selected{% endif %}>Carreta</option>
          <option value="Rodotrem" {% if request.GET.tipo_veiculo == "Rodotrem" %}selected{% endif %}>Rodotrem</option>
          <option value="Container" {% if request.GET.tipo_veiculo == "Container" %}selected{% endif %}>Container</option>
          <option value="Utilitario" {% if request.GET.tipo_veiculo == "Utilitario" %}selected{% endif %}>Utilitário</option>
        </select>
      </div>

      <div class="mb-3">
        <label class="form-label small">Turno</label>
        <select name="turno" class="form-select form-select-sm">
          <option value="">Todos</option>
          <option value="Manha" {% if request.GET.turno == "Manha" %}selected{% endif %}>Manhã</option>
          <option value="Tarde" {% if request.GET.turno == "Tarde" %}selected{% endif %}>Tarde</option>
          <option value="Noite" {% if request.GET.turno == "Noite" %}selected{% endif %}>Noite</option>
        </select>
      </div>

      <div class="mb-4">
        <label class="form-label small">Origem</label>
        <select name="un_origem" class="form-select form-select-sm">
          <option value="">Todas</option>
          <option value="UN10" {% if request.GET.un_origem == "UN10" %}selected{% endif %}>UN10</option>
          <option value="UN20" {% if request.GET.un_origem == "UN20" %}selected{% endif %}>UN20</option>
          <option value="UN40" {% if request.GET.un_origem == "UN40" %}selected{% endif %}>UN40</option>
          <option value="UN50" {% if request.GET.un_origem == "UN50" %}selected{% endif %}>UN50</option>
          <option value="CD09" {% if request.GET.un_origem == "CD09" %}selected{% endif %}>CD09</option>
          <option value="Outro" {% if request.GET.un_origem == "Outro" %}selected{% endif %}>Outros</option>
        </select>
      </div>

      <button type="submit" class="btn btn-primary btn-sm w-100">
        <i class="bi bi-funnel me-1"></i> Aplicar filtros
      </button>

    </form>

  </div>
</div>

<script>
  var tooltipTriggerList = [].slice.call(
    document.querySelectorAll('[data-bs-toggle="tooltip"]')
  );
  tooltipTriggerList.map(function (el) {
    return new bootstrap.Tooltip(el);
  });
</script>
{% endblock %}
