{% extends 'base.html' %}
{% load static %}

{% block title %}Inserir Transporte{% endblock %}

{% block content %}
<div class="container mt-5 d-flex justify-content-center">
  <div class="card shadow-lg border-0 rounded-4" style="max-width: 800px;">
    <div class="card-body p-5">
      <h2 class="text-center fw-bold mb-4 text-primary">
        <i class="bi bi-truck-front-fill me-2"></i> Inserir Transporte
      </h2>

      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags|default:'info' }} mt-3">{{ message }}</div>
        {% endfor %}
      {% endif %}

      <form method="post">
        {% csrf_token %}
        <div class="row g-4">
          <div class="col-md-4">
            <label class="form-label">LECOM</label>
            <input type="text" name="lecom" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Data da Carga</label>
            <input type="date" name="data" class="form-control" required>
          </div>
          <div class="col-md-4">
            <label class="form-label">Veículo</label>
            <input type="text" name="tipo_veiculo" class="form-control">
          </div>
          <div class="col-md-12">
            <label class="form-label">Observação</label>
            <input type="text" name="observacao" class="form-control">
          </div>
          <div class="col-md-2">
            <label class="form-label">Quantidade de Cargas</label>
            <input type="number" id="seqInput" name="seq" class="form-control" min="1" value="1" required>
          </div>
        </div>

        <div class="row g-4 mt-4" id="cargasContainer"></div>

        <div class="d-flex justify-content-end mt-4 gap-2">
          <a href="{% url 'expedicao:cenario_transporte' %}" class="btn btn-outline-secondary">Cancelar</a>
          <button type="submit" class="btn btn-primary">Salvar</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script>
document.addEventListener("DOMContentLoaded", () => {
  const seqInput = document.getElementById("seqInput");
  const cargasContainer = document.getElementById("cargasContainer");

  function renderCargas() {
    const qtd = parseInt(seqInput.value) || 0;
    const existingValues = {};
    cargasContainer.querySelectorAll("input").forEach(input => {
      existingValues[input.name] = input.value;
    });
    cargasContainer.innerHTML = "";

    for (let i = 1; i <= qtd; i++) {
      const col = document.createElement("div");
      col.classList.add("col-md-4", "mb-3");
      const value = existingValues[`carga_${i}`] || "";
      col.innerHTML = `
        <label class="form-label">Carga ${i} (Seq ${i})</label>
        <input type="text" name="carga_${i}" class="form-control" value="${value}" placeholder="Digite a carga ${i}" required>
        <input type="text" name="destino" class="form-control mt-1" placeholder="Destino">
        <input type="text" name="uf" class="form-control mt-1" placeholder="UF">
        <input type="number" name="peso" class="form-control mt-1" placeholder="Peso (Kg)">
        <input type="number" name="m3" class="form-control mt-1" placeholder="M³">
        <input type="text" name="mod" class="form-control mt-1" placeholder="MOD">
        <input type="number" name="entregas" class="form-control mt-1" placeholder="Entregas">
      `;
      cargasContainer.appendChild(col);
    }
  }

  seqInput.addEventListener("input", renderCargas);
  renderCargas();
});
</script>
{% endblock %}
