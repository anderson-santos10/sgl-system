{% extends "base.html" %}
{% load static %}

{% block title %}Editar Separação{% endblock %}

{% block content %}
<div class="container-fluid mt-4 px-lg-4">

    <!-- ================= HEADER ================= -->
    <div class="card shadow-sm border-0 mb-4 rounded-4">
        <div class="card-body">

            <h4 class="fw-bold text-primary mb-3">
                <i class="bi bi-box-seam"></i>
                Separação – Transporte {{ controle.lecom.lecom }}
            </h4>

            <div class="row small">
                <div class="col-md-3">
                    <strong>Destino:</strong><br>
                    {{ controle.lecom.destino }}
                </div>

                <div class="col-md-3">
                    <strong>Data:</strong><br>
                    {{ controle.lecom.data|date:"d/m/Y" }}
                </div>

                <div class="col-md-3">
                    <strong>Veículo:</strong><br>
                    {{ controle.lecom.veiculo.tipo_veiculo|default:"—" }}
                </div>

                <div class="col-md-3">
                    <strong>Status:</strong><br>
                    <span class="badge bg-warning text-dark">
                        {{ controle.status }}
                    </span>
                </div>
            </div>

        </div>
    </div>

    <!-- ================= CARGAS ================= -->
    <h5 class="fw-bold mb-3">
        <i class="bi bi-layers"></i> Cargas e Sequências
    </h5>

    <div class="row g-4">

        {% for carga in cargas %}
        <div class="col-md-6 col-lg-4">

            <form method="post" class="card h-100 shadow-sm border-0 rounded-4">
                {% csrf_token %}

                <div class="card-body">

                    <h6 class="fw-bold text-primary mb-2">
                        Carga {{ carga.numero_carga }}
                    </h6>

                    <p class="mb-2">
                        <strong>Resumo:</strong> {{ carga.seq }}
                    </p>

                    <div class="mb-2">
                        <strong>Separadores:</strong>
                        <ul class="mb-0 ps-3 small">
                            {% for separador in carga.separadores.all %}
                                <li>{{ separador.nome }}</li>
                            {% empty %}
                                <li class="text-muted">Nenhum separador definido</li>
                            {% endfor %}
                        </ul>
                    </div>

                    <span class="badge bg-info mb-3">
                        {{ carga.status }}
                    </span>

                    <hr>

                    <!-- ===== DOCUMENTOS DA CARGA ===== -->
                    <h6 class="fw-bold mb-2">
                        <i class="bi bi-file-earmark-check"></i>
                        Documentos
                    </h6>

                    <div class="small">

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="resumo_conf"
                                   {% if carga.resumo_conf %}checked{% endif %}>
                            <label class="form-check-label">
                                Resumo Conferente
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="resumo_motorista"
                                   {% if carga.resumo_motorista %}checked{% endif %}>
                            <label class="form-check-label">
                                Resumo Motorista
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="etiquetas_cds"
                                   {% if carga.etiquetas_cds %}checked{% endif %}>
                            <label class="form-check-label">
                                Etiquetas CDs
                            </label>
                        </div>

                        <div class="form-check">
                            <input class="form-check-input" type="checkbox"
                                   name="carga_gerada"
                                   {% if carga.carga_gerada %}checked{% endif %}>
                            <label class="form-check-label">
                                Carga Gerada
                            </label>
                        </div>

                    </div>

                </div>

                <!-- ===== AÇÕES DA CARGA ===== -->
                <div class="card-footer bg-white border-0 text-end">
                    <input type="hidden" name="carga_id" value="{{ carga.id }}">
                    <button type="submit" class="btn btn-success btn-sm">
                        <i class="bi bi-play-circle"></i> Iniciar
                    </button>
                </div>

            </form>

        </div>
        {% empty %}
            <p class="text-muted text-center">
                Nenhuma carga vinculada
            </p>
        {% endfor %}

    </div>

</div>
{% endblock %}
