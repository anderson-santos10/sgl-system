{% extends 'base.html' %}
{% load static %}

{% block title %}Transporte #{{ lecom.pk }}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/expedicao/analise_carga.css' %}">
{% endblock %}

{% block content %}
<div class="sgl-page">

  <!-- ================= HEADER ================= -->
  <header class="sgl-header sgl-header-inline">
    <div class="sgl-header-left">
      <h3>ID #{{ lecom.pk }}</h3>
      <small>
        LECOM: {{ lecom.lecom }} 
        <br>DESTINO: {{ lecom.destino }} / {{ lecom.uf }}
      </small>
    </div>

    <div class="sgl-header-right">
      {% include "components/status_badge.html" with status=lecom.status %}
    </div>
  </header>

  <!-- ================= KPIs ================= -->
  <section class="sgl-kpis sgl-kpis-compact">
    <div class="kpi">
      <span>Peso</span>
      <strong>{{ lecom.peso }} kg</strong>
    </div>

    <div class="kpi">
      <span>Volume</span>
      <strong>{{ lecom.m3 }} m³</strong>
    </div>

    <div class="kpi">
      <span>Cargas</span>
      <strong>{{ cargas|length }}</strong>
    </div>

    <div class="kpi">
      <span>Veículo</span>
      <strong>{{ lecom.veiculo.tipo_veiculo|default:"—" }}</strong>
    </div>
  </section>

  <!-- ================= DADOS ================= -->
  <section class="sgl-card sgl-card-compact">
    <div class="sgl-card-header">
      <h5>Dados do Transporte</h5>
    </div>

    <div class="sgl-grid sgl-grid-3">
      <div>
        <label>Destino</label>
        <p>{{ lecom.destino }}</p>
      </div>

      <div>
        <label>Data</label>
        <p>{{ lecom.data|date:"d/m/Y" }}</p>
      </div>

      <div>
        <label>Observação</label>
        <p>{{ lecom.observacao|default:"—" }}</p>
      </div>
    </div>
  </section>

  <!-- ================= DEFINIÇÃO DE CARREGAMENTO ================= -->
  <section class="sgl-card">
    <div class="sgl-card-header">
      <h5>Agendamento de Carregamento</h5>
    </div>

    <form method="post">
      {% csrf_token %}

      <div class="sgl-grid sgl-grid-3">

        <div>
          <label>Turno</label>
          <select name="turno" class="form-select" required>
            <option value="">Selecione</option>
            <option value="Manhã">Manhã</option>
            <option value="Tarde">Tarde</option>
            <option value="Noite">Noite</option>
          </select>
        </div>

        <div>
          <label>Data do Carregamento</label>
          <input type="date" name="data_carregamento" class="form-control" required>
        </div>

        <div>
          <label>Horário na Doca</label>
          <input type="time" name="hora_carregamento" class="form-control" required>
        </div>

      </div>

      <div class="sgl-actions mt-4">
        <button type="submit" class="btn btn-primary btn-lg">
          Liberar Separação
        </button>
      </div>

    </form>
  </section>

  <!-- ================= CARGAS ================= -->
  <section class="sgl-card">
    <div class="sgl-card-header sgl-card-header-inline">
      <h5>Cargas Vinculadas</h5>
      <span class="sgl-muted">{{ cargas|length }} registro(s)</span>
    </div>

    <div class="sgl-table">
      <div class="sgl-table-head">
        <span>SEQ</span>
        <span>Carga</span>
        <span>Entregas</span>
        <span>MOD</span>
      </div>

      {% for carga in cargas %}
      <div class="sgl-table-row">
        <span>{{ carga.seq }}</span>
        <span>{{ carga.carga }}</span>
        <span>{{ carga.total_entregas }}</span>
        <span>{{ carga.mod }}</span>
      </div>
      {% empty %}
      <div class="sgl-empty">
        Nenhuma carga vinculada
      </div>
      {% endfor %}
    </div>
  </section>

</div>
{% endblock %}
