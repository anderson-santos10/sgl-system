{% extends 'base.html' %}

{% block title %}Cenário Cards{% endblock %}

{% block content %}
<div class="container-fluid mt-4 px-lg-4">

    <!-- HEADER PADRÃO -->
    <div class="page-header text-center mb-4">
        <h4 class="fw-bold text-primary mb-1">
            <i class="bi bi-card-checklist me-1"></i>
            Cenário Carregamento Expedição
        </h4>
        <small class="text-muted">
            Acompanhamento do status das cargas em expedição
        </small>
    </div>

    <div class="row">

        <!-- COLUNA PRINCIPAL -->
        <div class="col-lg-10">

            <div class="row g-4">
                {% for carga in cargas %}
                <div class="col-md-6 col-lg-3" id="carga-{{ carga.id }}">
                    <div class="card shadow-sm border-0 h-100 position-relative rounded-4 bg-light">

                        <!-- STATUS -->
                        <div class="position-absolute top-0 end-0 m-2">
                            {% if carga.status == "Pendente" %}
                                <span class="badge bg-secondary">
                                    <i class="bi bi-hourglass-split"></i> Pendente
                                </span>
                            {% elif carga.status == "Andamento" %}
                                <span class="badge bg-warning text-dark">
                                    <i class="bi bi-arrow-repeat"></i> Em andamento
                                </span>
                            {% else %}
                                <span class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Concluído
                                </span>
                            {% endif %}
                        </div>

                        <div class="card-body d-flex flex-column mt-3">

                            <h6 class="fw-bold text-primary mb-2">
                                <i class="bi bi-truck"></i>
                                Destino:
                                <span class="text-dark">
                                    {{ carga.destino|default:"Não informado" }}
                                </span>
                            </h6>

                            <p class="mb-2">
                                <i class="bi bi-hash"></i>
                                Transporte:
                                <a href="{% url 'expedicao:detalhe_carga' carga.id %}"
                                   class="fw-semibold text-decoration-none text-warning">
                                    {{ carga.numero_transporte|default:"—" }}
                                </a>
                            </p>

                            <ul class="list-unstyled small mb-3">
                                <li><i class="bi bi-calendar-date"></i> {{ carga.data|date:"d/m/Y"|default:"—" }}</li>
                                <li><i class="bi bi-box"></i> OT: {{ carga.ot|default:"—" }}</li>
                                <li><i class="bi bi-truck-front"></i> {{ carga.tipo_veiculo|default:"—" }}</li>
                                <li><i class="bi bi-person-check"></i> Conferente: {{ carga.conferente|default:"—" }}</li>
                            </ul>

                            <div class="mb-3 small">
                                <strong>Documentos:</strong>
                                <ul class="ps-3 mb-0">
                                    {% if carga.resumo_conf %}<li>Resumo Conferente</li>{% endif %}
                                    {% if carga.resumo_motorista %}<li>Resumo Motorista</li>{% endif %}
                                    {% if carga.etiquetas_cds %}<li>Etiquetas CDs</li>{% endif %}
                                    {% if carga.carga_gerada %}<li>Carga Gerada</li>{% endif %}
                                    {% if not carga.resumo_conf and not carga.resumo_motorista and not carga.etiquetas_cds and not carga.carga_gerada %}
                                        <li class="text-muted">Nenhum documento</li>
                                    {% endif %}
                                </ul>
                            </div>

                            <!-- AÇÕES -->
                            <div class="mt-auto">

                                <div class="d-flex justify-content-between mb-2">
                                    <a href="{% url 'expedicao:editar_carga' carga.id %}"
                                       class="btn btn-sm btn-outline-warning">
                                        <i class="bi bi-pencil"></i>
                                    </a>
                                    <a href="{% url 'expedicao:excluir_carga' pk=carga.id %}"
                                       class="btn btn-sm btn-outline-danger">
                                        <i class="bi bi-trash"></i>
                                    </a>
                                </div>

                                {% if carga.status == "Pendente" %}
                                <form method="post" action="#carga-{{ carga.id }}">
                                    {% csrf_token %}
                                    <input type="hidden" name="carga_id" value="{{ carga.id }}">
                                    <button class="btn btn-outline-secondary w-100">
                                        <i class="bi bi-play-circle"></i> Iniciar
                                    </button>
                                </form>

                                {% elif carga.status == "Andamento" %}
                                <form method="post" action="#carga-{{ carga.id }}">
                                    {% csrf_token %}
                                    <input type="hidden" name="carga_id" value="{{ carga.id }}">
                                    <button class="btn btn-outline-warning w-100">
                                        <i class="bi bi-check2-circle"></i> Finalizar
                                    </button>
                                </form>

                                {% else %}
                                <button class="btn btn-outline-success w-100" disabled>
                                    <i class="bi bi-check-circle-fill"></i> Concluído
                                </button>
                                {% endif %}
                            </div>

                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-muted mt-4">
                    Nenhuma carga encontrada
                </p>
                {% endfor %}
            </div>
        </div>

        <!-- FILTRO LATERAL -->
        <div class="col-lg-2 d-none d-lg-block">
            <div class="card shadow-sm border-0 p-3 position-fixed"
                 style="right:20px; top:110px; width:220px;">

                <a href="{% url 'expedicao:cenario_expedicao' %}"
                   class="btn btn-sm btn-primary mb-3 w-100">
                    Inserir Carga
                </a>

                <h6 class="fw-bold mb-3">Filtros</h6>

                <form method="get">
                    <select name="status" class="form-select mb-2">
                        <option value="">Todos</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Andamento">Em andamento</option>
                        <option value="Concluido">Concluído</option>
                    </select>

                    <input type="text"
                           name="numero_transporte"
                           class="form-control mb-2"
                           placeholder="Nº Transporte"
                           value="{{ request.GET.numero_transporte }}">

                    <button class="btn btn-primary w-100">
                        Filtrar
                    </button>
                </form>
            </div>
        </div>

    </div>
</div>
{% endblock %}
