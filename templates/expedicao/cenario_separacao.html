{% extends 'base.html' %}

{% block title %}Cenário de Separação{% endblock %}

{% block content %}
<div class="container-fluid mt-4 px-lg-4">

    <!-- HEADER -->
    <div class="page-header text-center mb-4">
        <h4 class="fw-bold text-primary mb-1">
            <i class="bi bi-card-checklist me-1"></i>
            Cenário de Separação
        </h4>
        <small class="text-muted">
            Transportes liberados para separação
        </small>
    </div>

    <div class="row">

        <!-- COLUNA PRINCIPAL -->
        <div class="col-lg-10">
            <div class="row g-4">

                {% for controle in separacoes %}
                <div class="col-md-6 col-lg-3" id="lecom-{{ controle.pk }}">
                    <div class="card shadow-sm border-0 h-100 position-relative rounded-4 bg-light">

                        <!-- STATUS -->
                        <div class="position-absolute top-0 end-0 m-2">
                            {% if controle.status == "Pendente" %}
                                <span class="badge bg-secondary">
                                    <i class="bi bi-hourglass-split"></i> Pendente
                                </span>
                            {% elif controle.status == "Andamento" %}
                                <span class="badge bg-warning text-dark">
                                    <i class="bi bi-arrow-repeat"></i> Em andamento
                                </span>
                            {% else %}
                                <span class="badge bg-success">
                                    <i class="bi bi-check-circle"></i> Concluído
                                </span>
                            {% endif %}
                        </div>

                        <div class="card-body d-flex flex-column mt-3">

                            <!-- DESTINO -->
                            <h6 class="fw-bold text-primary mb-2">
                                <i class="bi bi-truck"></i>
                                Destino:
                                <span class="text-dark">
                                    {{ controle.lecom.destino }}
                                </span>
                            </h6>

                            <!-- TRANSPORTE -->
                            <p class="mb-2">
                                <i class="bi bi-hash"></i>
                                Transporte:
                                <a href="{% url 'expedicao:detalhe_card' controle.lecom.pk %}"
                                   class="fw-semibold text-decoration-none text-warning">
                                    {{ controle.lecom.lecom }}
                                </a>
                            </p>

                            <!-- INFORMAÇÕES -->
                            <ul class="list-unstyled small mb-3">
                                <li>
                                    <i class="bi bi-calendar-date"></i>
                                    {{ controle.lecom.data|date:"d/m/Y" }}
                                </li>
                                <li>
                                    <i class="bi bi-truck-front"></i>
                                    {{ controle.lecom.veiculo.tipo_veiculo|default:"—" }}
                                </li>
                                <li>
                                    <i class="bi bi-box-seam"></i>
                                    Cargas: {{ controle.cargas.count }}
                                </li>
                            </ul>

                            <!-- DOCUMENTOS -->
                            <div class="mb-3 small">
                                <strong>Documentos:</strong>
                                <ul class="ps-3 mb-0">
                                    {% if controle.resumo_conf %}<li>Resumo Conferente</li>{% endif %}
                                    {% if controle.resumo_motorista %}<li>Resumo Motorista</li>{% endif %}
                                    {% if controle.etiquetas_cds %}<li>Etiquetas CDs</li>{% endif %}
                                    {% if controle.carga_gerada %}<li>Carga Gerada</li>{% endif %}
                                    {% if not controle.resumo_conf and not controle.resumo_motorista and not controle.etiquetas_cds and not controle.carga_gerada %}
                                        <li class="text-muted">Nenhum documento</li>
                                    {% endif %}
                                </ul>
                            </div>

                            <!-- AÇÕES -->
                            <div class="mt-auto">

                                {% if controle.status == "Pendente" %}
                                    <form method="post">
                                        {% csrf_token %}
                                        <input type="hidden" name="controle_id" value="{{ controle.pk }}">
                                        <button class="btn btn-outline-secondary w-100">
                                            <i class="bi bi-play-circle"></i> Iniciar Separação
                                        </button>
                                    </form>

                                {% elif controle.status == "Andamento" %}
                                    <form method="post">
                                        {% csrf_token %}
                                        <input type="hidden" name="controle_id" value="{{ controle.pk }}">
                                        <button class="btn btn-outline-warning w-100">
                                            <i class="bi bi-check2-circle"></i> Finalizar Separação
                                        </button>
                                    </form>

                                {% else %}
                                    <button class="btn btn-outline-success w-100" disabled>
                                        <i class="bi bi-check-circle-fill"></i> Concluído
                                    </button>
                                {% endif %}

                            </div>

                        </div>
                    </div>
                </div>
                {% empty %}
                <p class="text-center text-muted mt-4">
                    Nenhum transporte no cenário de separação
                </p>
                {% endfor %}

            </div>
        </div>

        <!-- LATERAL -->
        <div class="col-lg-2 d-none d-lg-block">
            <div class="card shadow-sm border-0 p-3 position-fixed"
                 style="right:20px; top:110px; width:220px;">

                <a href="{% url 'expedicao:cenario_expedicao' %}"
                   class="btn btn-sm btn-primary mb-3 w-100">
                    Inserir Transporte
                </a>

                <h6 class="fw-bold mb-3">Filtros</h6>

                <form method="get">
                    <select name="status" class="form-select mb-2">
                        <option value="">Todos</option>
                        <option value="Pendente">Pendente</option>
                        <option value="Andamento">Em andamento</option>
                        <option value="Concluido">Concluído</option>
                    </select>

                    <button class="btn btn-primary w-100">
                        Filtrar
                    </button>
                </form>
            </div>
        </div>

    </div>
</div>
{% endblock %}
